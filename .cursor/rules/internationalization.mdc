# å›½é™…åŒ– (i18n) æŒ‡å—

## æŠ€æœ¯æ ˆ

æœ¬é¡¹ç›®ä½¿ç”¨ **Next-Intl** ä½œä¸ºå›½é™…åŒ–è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šè¯­è¨€åˆ‡æ¢å’Œæœ¬åœ°åŒ–åŠŸèƒ½ã€‚

### æ”¯æŒè¯­è¨€

- ğŸ‡ºğŸ‡¸ **English (en)** - é»˜è®¤è¯­è¨€
- ğŸ‡¨ğŸ‡³ **ä¸­æ–‡ç®€ä½“ (zh)** - ä¸­æ–‡æ”¯æŒ
- ğŸ‡¯ğŸ‡µ **æ—¥æœ¬èª (ja)** - æ—¥è¯­æ”¯æŒ

## æ ¸å¿ƒé…ç½®

### i18n è·¯ç”±é…ç½®
```typescript
// i18n/routing.ts
import { defineRouting } from 'next-intl/routing';

export const routing = defineRouting({
  locales: ['en', 'zh', 'ja'],
  defaultLocale: 'en',
  pathnames: {
    '/': '/',
    '/dashboard': {
      en: '/dashboard',
      zh: '/dashboard',
      ja: '/dashboard'
    },
    '/pricing': {
      en: '/pricing',
      zh: '/pricing',
      ja: '/pricing'
    }
  }
});
```

### i18n è¯·æ±‚é…ç½®
```typescript
// i18n/request.ts
import { getRequestConfig } from 'next-intl/server';
import { routing } from './routing';

export default getRequestConfig(async ({ locale }) => {
  // éªŒè¯ä¼ å…¥çš„ locale å‚æ•°
  if (!routing.locales.includes(locale as any)) {
    notFound();
  }

  return {
    messages: (await import(`../messages/${locale}.json`)).default
  };
});
```

### Next.js é…ç½®
```typescript
// next.config.ts
import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin('./i18n/request.ts');

/** @type {import('next').NextConfig} */
const nextConfig = {
  // å…¶ä»–é…ç½®
};

export default withNextIntl(nextConfig);
```

## ç¿»è¯‘æ–‡ä»¶ç»“æ„

### è‹±è¯­ç¿»è¯‘ (messages/en.json)
```json
{
  "common": {
    "loading": "Loading...",
    "error": "An error occurred",
    "success": "Success",
    "cancel": "Cancel",
    "confirm": "Confirm",
    "save": "Save",
    "delete": "Delete",
    "edit": "Edit"
  },
  "navigation": {
    "home": "Home",
    "dashboard": "Dashboard",
    "pricing": "Pricing",
    "login": "Login",
    "register": "Register",
    "logout": "Logout"
  },
  "auth": {
    "login": {
      "title": "Sign In",
      "email": "Email",
      "password": "Password",
      "submit": "Sign In",
      "forgotPassword": "Forgot Password?",
      "noAccount": "Don't have an account?",
      "signUp": "Sign Up"
    },
    "register": {
      "title": "Sign Up",
      "name": "Full Name",
      "email": "Email",
      "password": "Password",
      "confirmPassword": "Confirm Password",
      "submit": "Sign Up",
      "hasAccount": "Already have an account?",
      "signIn": "Sign In"
    }
  },
  "dashboard": {
    "title": "Dashboard",
    "welcome": "Welcome back, {name}!",
    "stats": {
      "totalUsers": "Total Users",
      "revenue": "Revenue",
      "orders": "Orders"
    }
  },
  "pricing": {
    "title": "Choose Your Plan",
    "monthly": "Monthly",
    "annually": "Annually",
    "features": "Features",
    "getStarted": "Get Started",
    "currentPlan": "Current Plan"
  }
}
```

### ä¸­æ–‡ç¿»è¯‘ (messages/zh.json)
```json
{
  "common": {
    "loading": "åŠ è½½ä¸­...",
    "error": "å‘ç”Ÿé”™è¯¯",
    "success": "æˆåŠŸ",
    "cancel": "å–æ¶ˆ",
    "confirm": "ç¡®è®¤",
    "save": "ä¿å­˜",
    "delete": "åˆ é™¤",
    "edit": "ç¼–è¾‘"
  },
  "navigation": {
    "home": "é¦–é¡µ",
    "dashboard": "ä»ªè¡¨æ¿",
    "pricing": "å®šä»·",
    "login": "ç™»å½•",
    "register": "æ³¨å†Œ",
    "logout": "é€€å‡º"
  },
  "auth": {
    "login": {
      "title": "ç™»å½•",
      "email": "é‚®ç®±",
      "password": "å¯†ç ",
      "submit": "ç™»å½•",
      "forgotPassword": "å¿˜è®°å¯†ç ï¼Ÿ",
      "noAccount": "æ²¡æœ‰è´¦æˆ·ï¼Ÿ",
      "signUp": "æ³¨å†Œ"
    },
    "register": {
      "title": "æ³¨å†Œ",
      "name": "å§“å",
      "email": "é‚®ç®±",
      "password": "å¯†ç ",
      "confirmPassword": "ç¡®è®¤å¯†ç ",
      "submit": "æ³¨å†Œ",
      "hasAccount": "å·²æœ‰è´¦æˆ·ï¼Ÿ",
      "signIn": "ç™»å½•"
    }
  },
  "dashboard": {
    "title": "ä»ªè¡¨æ¿",
    "welcome": "æ¬¢è¿å›æ¥ï¼Œ{name}ï¼",
    "stats": {
      "totalUsers": "æ€»ç”¨æˆ·æ•°",
      "revenue": "æ”¶å…¥",
      "orders": "è®¢å•"
    }
  },
  "pricing": {
    "title": "é€‰æ‹©æ‚¨çš„è®¡åˆ’",
    "monthly": "æœˆä»˜",
    "annually": "å¹´ä»˜",
    "features": "åŠŸèƒ½",
    "getStarted": "å¼€å§‹ä½¿ç”¨",
    "currentPlan": "å½“å‰è®¡åˆ’"
  }
}
```

### æ—¥è¯­ç¿»è¯‘ (messages/ja.json)
```json
{
  "common": {
    "loading": "èª­ã¿è¾¼ã¿ä¸­...",
    "error": "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",
    "success": "æˆåŠŸ",
    "cancel": "ã‚­ãƒ£ãƒ³ã‚»ãƒ«",
    "confirm": "ç¢ºèª",
    "save": "ä¿å­˜",
    "delete": "å‰Šé™¤",
    "edit": "ç·¨é›†"
  },
  "navigation": {
    "home": "ãƒ›ãƒ¼ãƒ ",
    "dashboard": "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
    "pricing": "æ–™é‡‘ãƒ—ãƒ©ãƒ³",
    "login": "ãƒ­ã‚°ã‚¤ãƒ³",
    "register": "ç™»éŒ²",
    "logout": "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"
  },
  "auth": {
    "login": {
      "title": "ãƒ­ã‚°ã‚¤ãƒ³",
      "email": "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
      "password": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",
      "submit": "ãƒ­ã‚°ã‚¤ãƒ³",
      "forgotPassword": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸæ–¹",
      "noAccount": "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹",
      "signUp": "ç™»éŒ²"
    },
    "register": {
      "title": "ç™»éŒ²",
      "name": "æ°å",
      "email": "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
      "password": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",
      "confirmPassword": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª",
      "submit": "ç™»éŒ²",
      "hasAccount": "æ—¢ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹",
      "signIn": "ãƒ­ã‚°ã‚¤ãƒ³"
    }
  },
  "dashboard": {
    "title": "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
    "welcome": "ãŠã‹ãˆã‚Šãªã•ã„ã€{name}ã•ã‚“ï¼",
    "stats": {
      "totalUsers": "ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°",
      "revenue": "åç›Š",
      "orders": "æ³¨æ–‡æ•°"
    }
  },
  "pricing": {
    "title": "ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ",
    "monthly": "æœˆé¡",
    "annually": "å¹´é¡",
    "features": "æ©Ÿèƒ½",
    "getStarted": "é–‹å§‹",
    "currentPlan": "ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³"
  }
}
```

## ä½¿ç”¨æ–¹æ³•

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç¿»è¯‘
```typescript
// components/Header.tsx
"use client";

import { useTranslations } from 'next-intl';
import { Link } from '@/i18n/routing';

export function Header() {
  const t = useTranslations('navigation');

  return (
    <header>
      <nav>
        <Link href="/">{t('home')}</Link>
        <Link href="/dashboard">{t('dashboard')}</Link>
        <Link href="/pricing">{t('pricing')}</Link>
      </nav>
    </header>
  );
}
```

### å¸¦å‚æ•°çš„ç¿»è¯‘
```typescript
// components/Dashboard.tsx
"use client";

import { useTranslations } from 'next-intl';

interface DashboardProps {
  userName: string;
}

export function Dashboard({ userName }: DashboardProps) {
  const t = useTranslations('dashboard');

  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('welcome', { name: userName })}</p>
    </div>
  );
}
```

### åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ä½¿ç”¨
```typescript
// app/[locale]/dashboard/page.tsx
import { getTranslations } from 'next-intl/server';

export default async function DashboardPage() {
  const t = await getTranslations('dashboard');

  return (
    <div>
      <h1>{t('title')}</h1>
      <div className="stats">
        <div>
          <h3>{t('stats.totalUsers')}</h3>
          <p>1,234</p>
        </div>
        <div>
          <h3>{t('stats.revenue')}</h3>
          <p>$12,345</p>
        </div>
      </div>
    </div>
  );
}
```

## è¯­è¨€åˆ‡æ¢å™¨

### è¯­è¨€åˆ‡æ¢ç»„ä»¶
```typescript
// components/language-switcher.tsx
"use client";

import { useLocale, useTranslations } from 'next-intl';
import { useRouter, usePathname } from '@/i18n/routing';
import { Button } from '@/components/ui/button';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';

const languages = [
  { code: 'en', name: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
  { code: 'zh', name: 'ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
  { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' },
];

export function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  const currentLanguage = languages.find(lang => lang.code === locale);

  const handleLanguageChange = (newLocale: string) => {
    router.push(pathname, { locale: newLocale });
  };

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="sm">
          {currentLanguage?.flag} {currentLanguage?.name}
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent>
        {languages.map((language) => (
          <DropdownMenuItem
            key={language.code}
            onClick={() => handleLanguageChange(language.code)}
            className={language.code === locale ? 'bg-accent' : ''}
          >
            {language.flag} {language.name}
          </DropdownMenuItem>
        ))}
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
```

## ä¸­é—´ä»¶é…ç½®

### å›½é™…åŒ–ä¸­é—´ä»¶
```typescript
// middleware.ts
import createMiddleware from 'next-intl/middleware';
import { betterFetch } from "@better-fetch/fetch";
import type { Session } from "better-auth/types";
import { NextRequest, NextResponse } from "next/server";
import { routing } from './i18n/routing';

// åˆ›å»ºå›½é™…åŒ–ä¸­é—´ä»¶
const intlMiddleware = createMiddleware(routing);

export default async function middleware(request: NextRequest) {
  // é¦–å…ˆå¤„ç†å›½é™…åŒ–
  const intlResponse = intlMiddleware(request);
  
  // å¦‚æœå›½é™…åŒ–ä¸­é—´ä»¶è¿”å›é‡å®šå‘ï¼Œç›´æ¥è¿”å›
  if (intlResponse.status === 302) {
    return intlResponse;
  }

  // ç„¶åå¤„ç†è®¤è¯
  const { data: session } = await betterFetch<Session>(
    "/api/auth/get-session",
    {
      baseURL: request.nextUrl.origin,
      headers: {
        cookie: request.headers.get("cookie") || "",
      },
    }
  );

  // ä¿æŠ¤ä»ªè¡¨æ¿è·¯ç”±
  if (request.nextUrl.pathname.includes('/dashboard')) {
    if (!session) {
      const loginUrl = new URL('/login', request.url);
      loginUrl.searchParams.set('callbackUrl', request.url);
      return NextResponse.redirect(loginUrl);
    }
  }

  // é‡å®šå‘å·²ç™»å½•ç”¨æˆ·
  if (request.nextUrl.pathname.includes('/login') || 
      request.nextUrl.pathname.includes('/register')) {
    if (session) {
      return NextResponse.redirect(new URL('/dashboard', request.url));
    }
  }

  return intlResponse;
}

export const config = {
  matcher: [
    // åŒ¹é…æ‰€æœ‰è·¯å¾„é™¤äº† apiã€_next/staticã€_next/image å’Œ favicon.ico
    '/((?!api|_next/static|_next/image|favicon.ico).*)',
  ],
};
```

## æ•°å­—å’Œæ—¥æœŸæ ¼å¼åŒ–

### æ•°å­—æ ¼å¼åŒ–
```typescript
// utils/formatters.ts
import { useFormatter } from 'next-intl';

export function useNumberFormatters() {
  const format = useFormatter();

  return {
    currency: (amount: number, currency = 'USD') =>
      format.number(amount, {
        style: 'currency',
        currency,
      }),
    
    percentage: (value: number) =>
      format.number(value, {
        style: 'percent',
        minimumFractionDigits: 1,
      }),
    
    decimal: (value: number) =>
      format.number(value, {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }),
  };
}
```

### æ—¥æœŸæ ¼å¼åŒ–
```typescript
// utils/date-formatters.ts
import { useFormatter } from 'next-intl';

export function useDateFormatters() {
  const format = useFormatter();

  return {
    short: (date: Date) =>
      format.dateTime(date, {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
      }),
    
    long: (date: Date) =>
      format.dateTime(date, {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long',
      }),
    
    time: (date: Date) =>
      format.dateTime(date, {
        hour: '2-digit',
        minute: '2-digit',
      }),
    
    relative: (date: Date) =>
      format.relativeTime(date),
  };
}
```

## è¡¨å•éªŒè¯å›½é™…åŒ–

### Zod é”™è¯¯æ¶ˆæ¯
```typescript
// lib/validations.ts
import { z } from 'zod';
import { getTranslations } from 'next-intl/server';

export async function createUserSchema() {
  const t = await getTranslations('validation');

  return z.object({
    name: z
      .string()
      .min(2, t('name.min'))
      .max(50, t('name.max')),
    email: z
      .string()
      .email(t('email.invalid')),
    password: z
      .string()
      .min(8, t('password.min'))
      .regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/, t('password.weak')),
  });
}
```

### éªŒè¯é”™è¯¯ç¿»è¯‘
```json
// messages/en.json (validation éƒ¨åˆ†)
{
  "validation": {
    "name": {
      "min": "Name must be at least 2 characters",
      "max": "Name cannot exceed 50 characters"
    },
    "email": {
      "invalid": "Please enter a valid email address"
    },
    "password": {
      "min": "Password must be at least 8 characters",
      "weak": "Password must contain uppercase, lowercase, and numbers"
    }
  }
}
```

## SEO å’Œå…ƒæ•°æ®

### å›½é™…åŒ–é¡µé¢å…ƒæ•°æ®
```typescript
// app/[locale]/layout.tsx
import { getTranslations } from 'next-intl/server';
import type { Metadata } from 'next';

interface RootLayoutProps {
  children: React.ReactNode;
  params: { locale: string };
}

export async function generateMetadata({
  params: { locale }
}: {
  params: { locale: string }
}): Promise<Metadata> {
  const t = await getTranslations({ locale, namespace: 'metadata' });

  return {
    title: {
      template: `%s | ${t('title')}`,
      default: t('title'),
    },
    description: t('description'),
    keywords: t('keywords').split(','),
  };
}
```

## æœ€ä½³å®è·µ

### 1. ç¿»è¯‘é”®å‘½å
- ä½¿ç”¨åµŒå¥—ç»“æ„ç»„ç»‡ç¿»è¯‘é”®
- ä½¿ç”¨æè¿°æ€§çš„é”®å
- ä¿æŒä¸€è‡´çš„å‘½åçº¦å®š

```json
{
  "auth": {
    "login": {
      "title": "Sign In",
      "form": {
        "email": "Email",
        "password": "Password"
      }
    }
  }
}
```

### 2. å ä½ç¬¦ä½¿ç”¨
```typescript
// å¥½çš„åšæ³•
t('welcome', { name: user.name, count: items.length });

// ç¿»è¯‘æ–‡ä»¶
{
  "welcome": "Welcome {name}! You have {count} items."
}
```

### 3. å¤æ•°å½¢å¼å¤„ç†
```json
{
  "items": {
    "zero": "No items",
    "one": "One item", 
    "other": "{count} items"
  }
}
```

### 4. ç¿»è¯‘æ–‡ä»¶ç®¡ç†
- ä¿æŒç¿»è¯‘æ–‡ä»¶åŒæ­¥
- ä½¿ç”¨ç¿»è¯‘å·¥å…·éªŒè¯å®Œæ•´æ€§
- å®šæœŸå®¡æŸ¥ç¿»è¯‘è´¨é‡

### 5. æ€§èƒ½ä¼˜åŒ–
```typescript
// æŒ‰éœ€åŠ è½½ç¿»è¯‘
const messagesPromise = import(`../messages/${locale}.json`);

// ç¼“å­˜ç¿»è¯‘
const messages = await messagesPromise;
```

### 6. æµ‹è¯•ç­–ç•¥
```typescript
// æµ‹è¯•ä¸åŒè¯­è¨€çš„ç»„ä»¶
describe('Header Component', () => {
  it('renders in English', () => {
    render(<Header />, { locale: 'en' });
    expect(screen.getByText('Home')).toBeInTheDocument();
  });

  it('renders in Chinese', () => {
    render(<Header />, { locale: 'zh' });
    expect(screen.getByText('é¦–é¡µ')).toBeInTheDocument();
  });
});
```

## ç¿»è¯‘å·¥ä½œæµ

### 1. æ·»åŠ æ–°ç¿»è¯‘
1. åœ¨è‹±æ–‡ç¿»è¯‘æ–‡ä»¶ä¸­æ·»åŠ æ–°é”®
2. åœ¨å…¶ä»–è¯­è¨€æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”ç¿»è¯‘
3. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ–°çš„ç¿»è¯‘é”®
4. æµ‹è¯•æ‰€æœ‰è¯­è¨€ç‰ˆæœ¬

### 2. æ›´æ–°ç°æœ‰ç¿»è¯‘
1. ä¿®æ”¹ç¿»è¯‘æ–‡ä»¶
2. æ£€æŸ¥æ‰€æœ‰ä½¿ç”¨è¯¥é”®çš„ç»„ä»¶
3. éªŒè¯ç¿»è¯‘å‡†ç¡®æ€§
4. æ›´æ–°ç›¸å…³æµ‹è¯•

### 3. ç¿»è¯‘éªŒè¯è„šæœ¬
```typescript
// scripts/validate-translations.ts
import fs from 'fs';
import path from 'path';

const locales = ['en', 'zh', 'ja'];
const messagesDir = path.join(process.cwd(), 'messages');

function validateTranslations() {
  const enMessages = JSON.parse(
    fs.readFileSync(path.join(messagesDir, 'en.json'), 'utf8')
  );

  const missingKeys: Record<string, string[]> = {};

  locales.slice(1).forEach(locale => {
    const messages = JSON.parse(
      fs.readFileSync(path.join(messagesDir, `${locale}.json`), 'utf8')
    );
    
    missingKeys[locale] = findMissingKeys(enMessages, messages);
  });

  console.log('Missing translations:', missingKeys);
}

function findMissingKeys(source: any, target: any, prefix = ''): string[] {
  const missing: string[] = [];
  
  Object.keys(source).forEach(key => {
    const fullKey = prefix ? `${prefix}.${key}` : key;
    
    if (!(key in target)) {
      missing.push(fullKey);
    } else if (typeof source[key] === 'object' && typeof target[key] === 'object') {
      missing.push(...findMissingKeys(source[key], target[key], fullKey));
    }
  });
  
  return missing;
}

validateTranslations();
```
description:
globs:
alwaysApply: false
---
